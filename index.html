<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multiplication Sky Runner</title>
  <!-- MODIFICATION: Correct SDK script -->
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(to bottom, #87CEEB 0%, #98D8E8 50%, #B0E0E6 100%);
            height: 100%;
            overflow: hidden;
            user-select: none;
        }

        html {
            height: 100%;
        }

        .game-container {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 600px;
        }

        .clouds {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(ellipse 80px 40px at 100px 100px, white 40%, transparent 50%),
                radial-gradient(ellipse 60px 30px at 300px 150px, white 40%, transparent 50%),
                radial-gradient(ellipse 100px 50px at 500px 80px, white 40%, transparent 50%),
                radial-gradient(ellipse 70px 35px at 700px 200px, white 40%, transparent 50%);
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translateX(0); }
            100% { transform: translateX(-200px); }
        }

        /* MODIFICATION: Updated UI Panel */
        .ui-panel {
            position: absolute;
            top: 10px;
            left: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 20px; /* Increased padding */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 100;
            /* Removed fixed height */
        }

        /* MODIFICATION: game-stats is now the main flex container */
        .game-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* Removed margin-bottom */
        }

        /* NEW CLASS for left-side stats */
        .stats-left {
            display: flex;
            align-items: center;
            gap: 20px;
            background: #fff;
            padding: 5px 10px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .level-display {
            font-size: 16px;
            font-weight: bold;
            color: #2E8B57;
        }

        .lives-display {
            display: flex;
            align-items: center;
            gap: 3px;
            font-size: 16px;
            font-weight: bold;
            color: #d9534f;
        }

        #lives-container {
            display: flex;
            gap: 4px;
        }

        .heart {
            width: 18px;
            height: 18px;
            background: #FF6B6B;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            transform: rotate(-45deg);
            position: relative;
        }

        .heart::before {
            content: '';
            width: 9px;
            height: 14px;
            position: absolute;
            left: 9px;
            top: 0;
            background: #FF6B6B;
            border-radius: 50px 50px 0 0;
            transform: rotate(-45deg);
            transform-origin: 0 100%;
        }

        .heart::after {
            content: '';
            width: 9px;
            height: 14px;
            position: absolute;
            left: 0;
            top: -4px;
            background: #FF6B6B;
            border-radius: 50px 50px 0 0;
            transform: rotate(45deg);
            transform-origin: 100% 100%;
        }

        .score-display {
            font-size: 16px;
            font-weight: bold;
            color: #4169E1;
            background: #fff;
            padding: 5px 10px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* MODIFICATION: Question is now center element */
        .question-display {
            text-align: center;
            font-size: 28px; /* Doubled size */
            font-weight: bold;
            color: #2E8B57;
            background: #F0F8FF;
            padding: 4px 8px;
            border-radius: 6px;
            border: 2px solid #4169E1;
            flex-grow: 1; /* Makes it take center space */
            margin: 0 20px; /* Adds spacing */
        }

        /* MODIFICATION: Cinnamoroll character style */
        .character {
            position: absolute;
            left: 80px;
            width: 80px;  /* Increased size for image */
            height: 80px; /* Increased size for image */
            background-image: url('image/cinnamoroll.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            transition: top 0.1s ease;
            z-index: 50;
        }

        .answer-option {
            position: absolute;
            right: -600px; /* Start position for transform */
            width: 80px;
            height: 80px;
            
            /* MODIFICATION: Single pink color style */
            background: #FFB6C1;
            border: 3px solid #FF69B4;
            /* END MODIFICATION */

            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px; /* MODIFICATION: Doubled size */
            font-weight: bold;
            color: black; 
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            /* MODIFICATION: Added transform animation */
            animation: moveLeft 8s linear infinite, candyShine 2s ease-in-out infinite alternate;
            position: relative;
        }

        .answer-option::before {
            content: 'üç¨'; /* All are candies */
            position: absolute;
            top: -8px;
            right: -5px;
            font-size: 20px;
            z-index: 1;
        }

        .answer-option::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 25px;
            width: 20px;
            height: 15px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            transform: rotate(-20deg);
        }

        @keyframes candyShine {
            0% { box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4), inset 0 2px 8px rgba(255, 255, 255, 0.3); }
            100% { box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5), inset 0 4px 12px rgba(255, 255, 255, 0.5); }
        }

        /* MODIFICATION: Use transform for smooth animation */
        @keyframes moveLeft {
            0% { 
                transform: translateX(0); 
            }
            100% { 
                transform: translateX(calc(-100vw - 600px)); 
            }
        }

        .game-over-screen, .level-complete-screen, .level-select-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }

        .level-select-screen {
            display: flex;
        }

        .level-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .level-btn {
            padding: 20px;
            text-align: left;
            background: linear-gradient(45deg, #32CD32, #228B22);
            min-width: 250px;
        }

        .level-btn:hover {
            background: linear-gradient(45deg, #228B22, #006400);
        }

        .level-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .level-desc {
            font-size: 16px;
            margin-bottom: 3px;
            opacity: 0.9;
        }

        .level-example {
            font-size: 14px;
            opacity: 0.8;
        }

        .modal {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .modal h2 {
            color: #2E8B57;
            margin-bottom: 20px;
            font-size: 36px;
        }

        .modal p {
            font-size: 20px;
            margin-bottom: 30px;
            color: #333;
        }

        .btn {
            background: linear-gradient(45deg, #4169E1, #6495ED);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .controls-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            color: #333;
        }

        .touch-controls {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 60;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, rgba(255, 107, 107, 0.4), rgba(255, 142, 142, 0.4));
            border: 2px solid rgba(255, 68, 68, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }

        .control-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .control-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .control-btn.up {
            background: linear-gradient(45deg, rgba(76, 175, 80, 0.4), rgba(102, 187, 106, 0.4));
            border-color: rgba(56, 142, 60, 0.5);
        }

        .control-btn.down {
            background: linear-gradient(45deg, rgba(33, 150, 243, 0.4), rgba(66, 165, 245, 0.4));
            border-color: rgba(25, 118, 210, 0.5);
        }

        .feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: bold;
            z-index: 150;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .feedback.correct {
            color: #32CD32;
        }

        .feedback.wrong {
            color: #FF4500;
        }

        .feedback.show {
            opacity: 1;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="game-container">
   <div class="clouds"></div>

   <!-- MODIFICATION: Updated UI Panel Layout -->
   <div class="ui-panel">
    <div class="game-stats">
        <div class="stats-left">
            <div class="level-display">Level <span id="current-level">1</span></div>
            <div class="lives-display">
                <span>Lives: </span>
                <div id="lives-container">
                   <div class="heart"></div>
                   <div class="heart"></div>
                   <div class="heart"></div>
                </div>
            </div>
        </div>
        <div class="question-display" id="question">2 √ó 3 = ?</div>
        <div class="score-display">Score: <span id="score">0</span></div>
    </div>
   </div>
   <!-- END MODIFICATION -->

   <div class="character" id="character"></div>
   <div class="touch-controls">
    <div class="control-btn up" id="up-btn">
     ‚Üë
    </div>
    <div class="control-btn down" id="down-btn">
     ‚Üì
    </div>
   </div>
   <div class="feedback" id="feedback"></div>
   <div class="controls-info"><strong>Controls:</strong><br>
     Touch buttons or use keyboard<br>
     ‚Üë/‚Üì Arrow Keys or W/S
   </div>
   <div class="game-over-screen" id="game-over-screen">
    <div class="modal">
     <h2>Game Over!</h2>
     <p>Final Score: <span id="final-score">0</span></p>
     <p>Level Reached: <span id="final-level">1</span></p><button class="btn" onclick="restartGame()">Play Again</button>
    </div>
   </div>
   <div class="level-complete-screen" id="level-complete-screen">
    <div class="modal">
     <h2>Level Complete! üéâ</h2>
     <p>Great job! Ready for the next challenge?</p><button class="btn" onclick="nextLevel()">Next Level</button>
    </div>
   </div>
   <div class="level-select-screen" id="level-select-screen">
    <div class="modal">
     <h2>üéØ Multiplication Sky Runner</h2>
     <p>Choose your difficulty level:</p>
     <div class="level-buttons"><button class="btn level-btn" onclick="startGameAtLevel(1)">
       <div class="level-title">
        Level 1
       </div>
       <div class="level-desc">
        1 √ó 1 digit
       </div>
       <div class="level-example">
        Example: 3 √ó 7
       </div></button> <button class="btn level-btn" onclick="startGameAtLevel(2)">
       <div class="level-title">
        Level 2
       </div>
       <div class="level-desc">
        2 √ó 1 digit
       </div>
       <div class="level-example">
        Example: 23 √ó 4
       </div></button> <button class="btn level-btn" onclick="startGameAtLevel(3)">
       <div class="level-title">
        Level 3
       </div>
       <div class="level-desc">
        3 √ó 2 digit
       </div>
       <div class="level-example">
        Example: 145 √ó 12
       </div></button>
     </div>
    </div>
   </div>
  </div>
  <script>
        class MultiplicationGame {
            constructor() {
                this.level = 1;
                this.lives = 3;
                this.score = 0;
                this.currentQuestion = null;
                this.correctAnswer = null;
                this.character = document.getElementById('character');
                this.characterPosition = 250; // Middle position
                this.gameRunning = false;
                this.questionCount = 0;
                this.questionsPerLevel = 10;
                this.activeCandies = new Set();
                this.questionAnswered = false;
                
                this.initializeGame();
                this.setupControls();
                // Don't auto-start level - wait for level selection
            }

            initializeGame() {
                this.character.style.top = this.characterPosition + 'px';
                this.updateUI();
            }

            setupControls() {
                // Keyboard controls
                document.addEventListener('keydown', (e) => {
                    if (!this.gameRunning) return;
                    
                    switch(e.key) {
                        case 'ArrowUp':
                        case 'w':
                        case 'W':
                            this.moveCharacter(-60);
                            break;
                        case 'ArrowDown':
                        case 's':
                        case 'S':
                            this.moveCharacter(60);
                            break;
                    }
                });

                // Touch controls
                const upBtn = document.getElementById('up-btn');
                const downBtn = document.getElementById('down-btn');

                upBtn.addEventListener('click', () => {
                    if (this.gameRunning) this.moveCharacter(-60);
                });

                downBtn.addEventListener('click', () => {
                    if (this.gameRunning) this.moveCharacter(60);
                });

                // Touch events for better mobile experience
                upBtn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (this.gameRunning) this.moveCharacter(-60);
                });

                downBtn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (this.gameRunning) this.moveCharacter(60);
                });
            }

            moveCharacter(delta) {
                // MODIFICATION: Update vertical constraints to account for larger UI panel
                const uiPanelHeight = document.querySelector('.ui-panel').offsetHeight;
                const minTop = uiPanelHeight + 20; // Just below panel
                const maxTop = document.querySelector('.game-container').clientHeight - 100; // 80px char + 20px padding
                
                this.characterPosition = Math.max(minTop, Math.min(maxTop, this.characterPosition + delta));
                this.character.style.top = this.characterPosition + 'px';
            }

            generateQuestion() {
                let num1, num2;
                
                switch(this.level) {
                    case 1: // 1 digit √ó 1 digit
                        num1 = Math.floor(Math.random() * 9) + 1;
                        num2 = Math.floor(Math.random() * 9) + 1;
                        break;
                    case 2: // 2 digits √ó 1 digit
                        num1 = Math.floor(Math.random() * 90) + 10;
                        num2 = Math.floor(Math.random() * 9) + 1;
                        break;
                    case 3: // 2-3 digits √ó 2 digits
                        num1 = Math.floor(Math.random() * 900) + 100;
                        num2 = Math.floor(Math.random() * 90) + 10;
                        break;
                }
                
                this.correctAnswer = num1 * num2;
                this.currentQuestion = `${num1} √ó ${num2} = ?`;
                this.questionAnswered = false; 
                
                document.getElementById('question').textContent = this.currentQuestion;
                
                this.generateAnswerOptions();
            }

            generateAnswerOptions() {
                // Clear existing options
                document.querySelectorAll('.answer-option').forEach(option => option.remove());
                
                // MODIFICATION: 4 positions
                const uiPanelHeight = document.querySelector('.ui-panel').offsetHeight;
                const minTop = uiPanelHeight + 20;
                const maxTop = document.querySelector('.game-container').clientHeight - 100;
                const spacing = (maxTop - minTop) / 3; // 3 gaps for 4 items
                
                const positions = [
                    minTop, 
                    minTop + spacing, 
                    minTop + (spacing * 2), 
                    maxTop
                ];
                
                // MODIFICATION: Generate 3 wrong answers
                const wrongAnswers = [];
                let attempts = 0;
                while(wrongAnswers.length < 3 && attempts < 50) { // 3 wrong answers
                    attempts++;
                    let wrongAnswer;
                    const variation = Math.floor(Math.random() * 20) + 1;
                    
                    if(Math.random() < 0.5) {
                        wrongAnswer = this.correctAnswer + variation;
                    } else {
                        wrongAnswer = Math.max(1, this.correctAnswer - variation);
                    }
                    
                    if(wrongAnswer !== this.correctAnswer && !wrongAnswers.includes(wrongAnswer)) {
                        wrongAnswers.push(wrongAnswer);
                    }
                }
                
                // MODIFICATION: Ensure we have 3 wrong answers
                while(wrongAnswers.length < 3) {
                    const fallback = this.correctAnswer + (wrongAnswers.length + 1) * 5;
                    if(!wrongAnswers.includes(fallback)) {
                        wrongAnswers.push(fallback);
                    }
                }
                
                // MODIFICATION: 4 total answers
                const allAnswers = [this.correctAnswer, wrongAnswers[0], wrongAnswers[1], wrongAnswers[2]];
                
                for(let i = allAnswers.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [allAnswers[i], allAnswers[j]] = [allAnswers[j], allAnswers[i]];
                }
                
                if(!allAnswers.includes(this.correctAnswer)) {
                    console.error('Correct answer missing after shuffle!');
                    allAnswers[0] = this.correctAnswer;
                }
                
                this.activeCandies = new Set();
                
                allAnswers.forEach((answer, index) => {
                    const option = document.createElement('div');
                    option.className = 'answer-option';
                    option.textContent = answer;
                    option.style.top = positions[index] + 'px';
                    option.dataset.answer = answer;
                    const candyId = `candy_${Date.now()}_${index}`;
                    option.dataset.candyId = candyId;
                    
                    this.activeCandies.add(candyId);
                    
                    // We still add the class for logic, even though there's no style
                    if(parseInt(answer) === parseInt(this.correctAnswer)) {
                        option.classList.add('correct');
                    } else {
                        option.classList.add('wrong');
                    }
                    
                    document.querySelector('.game-container').appendChild(option);
                    
                    const collisionInterval = setInterval(() => {
                        if(!option.parentNode || !this.gameRunning || !this.activeCandies.has(option.dataset.candyId)) {
                            clearInterval(collisionInterval);
                            return;
                        }
                        this.checkCollision(option, collisionInterval);
                    }, 50);
                    
                    setTimeout(() => {
                        if(option.parentNode && this.activeCandies.has(option.dataset.candyId)) {
                            option.remove();
                            this.activeCandies.delete(option.dataset.candyId);
                            clearInterval(collisionInterval);

                            if(option.classList.contains('correct') && !this.questionAnswered) {
                                this.handleMiss();
                            }
                        }
                    }, 8000);
                });
                
                console.log('Generated answers:', allAnswers, 'Correct answer:', this.correctAnswer);
            }

            checkCollision(option, collisionInterval) {
                if(!this.gameRunning || !option.parentNode || !this.activeCandies.has(option.dataset.candyId)) return;
                
                const optionRect = option.getBoundingClientRect();
                const characterRect = this.character.getBoundingClientRect();
                
                if(optionRect.right < 0) {
                    return; 
                }
                
                const collision = !(optionRect.right < characterRect.left - 10 || 
                                  optionRect.left > characterRect.right + 10 || 
                                  optionRect.bottom < characterRect.top - 10 || 
                                  optionRect.top > characterRect.bottom + 10);
                
                if(collision) {
                    const answer = parseInt(option.dataset.answer);
                    const isCorrect = option.classList.contains('correct');
                    const candyId = option.dataset.candyId;
                    
                    if(option.dataset.caught) return;
                    option.dataset.caught = 'true';
                    
                    this.activeCandies.delete(candyId);
                    
                    option.remove();
                    clearInterval(collisionInterval);
                    
                    document.querySelectorAll('.answer-option').forEach(opt => {
                        if(opt !== option && this.activeCandies.has(opt.dataset.candyId)) {
                            this.activeCandies.delete(opt.dataset.candyId);
                            opt.remove();
                        }
                    });
                    
                    if(isCorrect) {
                        this.handleCorrectAnswer();
                    } else {
                        this.handleWrongAnswer();
                    }
                }
            }

            handleCorrectAnswer() {
                this.questionAnswered = true;
                this.score += 1;
                this.questionCount++;
                this.showFeedback('Correct! +1 Point', 'correct');
                this.updateUI();
                
                if(this.questionCount >= this.questionsPerLevel) {
                    this.completeLevel();
                } else {
                    setTimeout(() => this.generateQuestion(), 1500);
                }
            }

            handleWrongAnswer() {
                this.questionAnswered = true; 
                this.lives--;
                this.showFeedback('Wrong! -1 Life', 'wrong');
                this.updateUI();
                
                const characterEl = document.getElementById('character');
                if (characterEl) {
                    characterEl.style.backgroundImage = "url('image/crying.png')";
                    
                    setTimeout(() => {
                        characterEl.style.backgroundImage = "url('image/cinnamoroll.png')";
                    }, 2000);
                }
                
                if(this.lives <= 0) {
                    this.gameOver();
                } else {
                    setTimeout(() => this.generateQuestion(), 1500);
                }
            }

            handleMiss() {
                if (this.questionAnswered) return; 

                this.questionAnswered = true;
                this.lives--;
                this.showFeedback('Missed! -1 Life', 'wrong');
                this.updateUI();
                
                document.querySelectorAll('.answer-option').forEach(opt => {
                    if(this.activeCandies.has(opt.dataset.candyId)) {
                        this.activeCandies.delete(opt.dataset.candyId);
                        opt.remove();
                    }
                });
                
                if(this.lives <= 0) {
                    this.gameOver();
                } else {
                    setTimeout(() => this.generateQuestion(), 1500);
                }
            }

            showFeedback(text, type) {
                const feedback = document.getElementById('feedback');
                feedback.textContent = text;
                feedback.className = `feedback ${type} show`;
                
                setTimeout(() => {
                    feedback.classList.remove('show');
                }, 1000);
            }

            updateUI() {
                document.getElementById('current-level').textContent = this.level;
                document.getElementById('score').textContent = this.score;
                
                const livesContainer = document.getElementById('lives-container');
                livesContainer.innerHTML = '';
                for(let i = 0; i < this.lives; i++) {
                    const heart = document.createElement('div');
                    heart.className = 'heart';
                    livesContainer.appendChild(heart);
                }
            }

            startLevel() {
                this.gameRunning = true;
                this.questionCount = 0;
                this.generateQuestion();
            }

            completeLevel() {
                this.gameRunning = false;
                
                if(this.level < 3) {
                    document.getElementById('level-complete-screen').style.display = 'flex';
                } else {
                    this.gameWin();
                }
            }

            nextLevel() {
                this.level++;
                this.lives = Math.min(3, this.lives + 1); // Bonus life
                document.getElementById('level-complete-screen').style.display = 'none';
                this.updateUI();
                this.startLevel();
            }

            gameWin() {
                document.getElementById('final-score').textContent = this.score;
                document.getElementById('final-level').textContent = this.level;
                document.querySelector('#game-over-screen h2').textContent = 'Congratulations! üèÜ';
                document.querySelector('#game-over-screen p').innerHTML = 
                    `You completed all levels!<br>Final Score: <span id="final-score">${this.score}</span>`;
                document.getElementById('game-over-screen').style.display = 'flex';
            }

            gameOver() {
                this.gameRunning = false;
                document.getElementById('final-score').textContent = this.score;
                document.getElementById('final-level').textContent = this.level;
                document.getElementById('game-over-screen').style.display = 'flex';
            }

            restart() {
                this.level = 1;
                this.lives = 3;
                this.score = 0;
                this.questionCount = 0;
                
                // MODIFICATION: Reset character position dynamically
                const uiPanelHeight = document.querySelector('.ui-panel').offsetHeight;
                const minTop = uiPanelHeight + 20;
                this.characterPosition = minTop + 150; // Place in middle of new range
                
                this.character.style.top = this.characterPosition + 'px';
                
                document.getElementById('character').style.backgroundImage = "url('image/cinnamoroll.png')";
                
                document.querySelectorAll('.answer-option').forEach(option => option.remove());
                
                document.getElementById('game-over-screen').style.display = 'none';
                document.getElementById('level-complete-screen').style.display = 'none';
                
                this.updateUI();
                this.startLevel();
            }
        }

        let game;

        function restartGame() {
            document.getElementById('level-select-screen').style.display = 'flex';
            document.getElementById('game-over-screen').style.display = 'none';
            document.getElementById('character').style.backgroundImage = "url('image/cinnamoroll.png')";
        }

        function nextLevel() {
            game.nextLevel();
        }

        function startGameAtLevel(selectedLevel) {
            document.getElementById('level-select-screen').style.display = 'none';
            game = new MultiplicationGame();
            game.level = selectedLevel;
            game.updateUI();
            game.startLevel();
        }

        window.addEventListener('load', () => {
            document.getElementById('level-select-screen').style.display = 'flex';
        });

        if (window.ElementSDK) {
            const sdk = window.ElementSDK.init();
            
            const defaultConfig = {
                game_title: "Multiplication Sky Runner"
            };

            // MODIFICATION: Fixed typo game_T_title -> game_title
            document.querySelector('#level-select-screen h2').textContent = defaultConfig.game_title;
            
            sdk.onConfigDidChange((config) => {
                const title = config.game_title || defaultConfig.game_title;
                document.querySelector('#level-select-screen h2').textContent = title;
            });
            
            sdk.readiness.setReady();
            
            sdk.expose.capabilities({
                config: {
                    props: [
                        {
                            id: "game_title",
                            label: "Game Title",
                            type: "text"
                        }
                    ]
                },
                mapToCapabilities: (config) => ({
                    recolorables: [],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined
                }),
                mapToEditPanelValues: (config) => new Map([
                    ["game_title", config.game_title || defaultConfig.game_title]
                ])
            });
        }
    </script>
 </body>
</html>
